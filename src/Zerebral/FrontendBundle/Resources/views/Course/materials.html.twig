{% extends 'ZerebralFrontendBundle::layout.html.twig' %}
{% import "ZerebralFrontendBundle:Macro:main.html.twig" as mainPartials %}

{% block content %}
    {% javascripts
    '@ZerebralFrontendBundle/Resources/public/js/controllers/course/materials.js'
    output='js/compiled/materials.js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <div class="top-second-navbar">
        {{ mainPartials.topMenu('materials', course) }}
    </div>
    <div class="row-fluid materials-list">
        <div class="span6 main-list-block">
            <div class="row-fluid">
                <h2 class="pull-left form-title">
                    {{ course.name }} <small><a href="{{ path('course_materials', {id: course.id}) }}">Syllabus</a> {{ folder ? '/ ' ~ folder.name : '' }}</small>
                </h2>
            </div>
            <hr/>

            <div class="span9 items-list{% if is_granted('ROLE_TEACHER') %} teacher-role{% endif %}">
                {% for date,day in dayMaterials %}
                    <div class="date">{{ date | date('l, d F Y') }}</div>

                    {% for material in day %}
                        <div class="material-item{{ loop.last ? ' last' : '' }}">
                            <div class="type">
                                <img src="/img/{{ get_file_icon(material.file).name }}" width="30"/>
                            </div>
                            <div class="details">
                                <div class="title">
                                    <h3>{{ material.file.name }}</h3>
                                </div>
                                <div class="description">{{ material.description }}</div>
                                <div class="info">
                                    by {{ material.teacher.fullName }} {% if material.courseFolder %}in <a href="{{ path('course_materials_folder', {id: course.id, folderId: material.folderId}) }}" class="folder"><i class="icon-small-folder"></i>{{ material.courseFolder.name }}</a>{% endif %} {{ material.file.size | bytes_to_human }} <span class="separator">/</span>
                                    <div class="manage-buttons">
                                        <a href="#"><i class="icon-small-pencil"></i>Edit</a> <a href="#"><i class="icon-small-trash-bin"></i>Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% endfor %}
                {% endfor %}
            </div>
        </div>

        <div class="right-navbar pull-left">
            {% if is_granted('ROLE_TEACHER') %}
                <div class="top-buttons">
                    <a href="{{ path('assignment_add', {courseId: course.id}) }}" class="btn big-button upload-file">upload file</a>
                    <a href="{{ path('assignments') }}" class="btn big-button">create folder</a>
                </div>
            {% endif %}

            <div class="block">
                <h4>sort by</h4>
                <ul class="radio">
                    <li><label><input type="radio" name="MaterialFilter"/> Date and time</label></li>
                    <li><label><input type="radio" name="MaterialFilter"/> A-Z</label></li>
                    <li><label><input type="radio" name="MaterialFilter"/> Folder</label></li>
                </ul>
            </div>

            <div class="block folders">
                <h4>Folders</h4>

                <ul class="marker">
                    <li {{ folder == null ? 'class="active"' : '' }}><i class="marker">&#9656;</i><a href="{{ path('course_materials', {id: course.id}) }}">All files</a></li>
                    {% for courseFolder in course.courseFolders %}
                        <li {{ folder and courseFolder.id == folder.id ? 'class="active"' : '' }} folderId="{{ courseFolder.id }}" courseId="{{ course.id }}" folderName="{{ courseFolder.name }}">
                            <i class="marker">&#9656;</i>
                            <a href="{{ path('course_materials_folder', {id: course.id, folderId: courseFolder.id}) }}">{{ courseFolder.name }}</a>
                            <div class="manage">
                                <i class="manage-buttons-gears icon-small-gears"></i>
                                <div class="manage-buttons invisible">
                                    {% if is_granted('EDIT', courseFolder) %}<a href="#" class="edit"><i class="icon-small-pencil"></i>Edit</a>{% endif %}
                                    {% if is_granted('DELETE', courseFolder) %}<a href="{{ path('delete_folder', {id: courseFolder.id}) }}" class="delete"><i class="icon-small-trash-bin"></i>Delete</a>{% endif %}
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>

        </div>

    </div>

    <div class="modal hide fade" id="editFolderModal">
        <form class="form-vertical folder-form" action="{{ path('ajax_course_join') }}" method="post" {{ form_enctype(folderRenameForm) }} novalidate>
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>Rename folder</h3>
            </div>
            <div class="modal-body">
                {{ form_row(folderRenameForm.name, {
                    label: 'Name',
                    form_type: 'horizontal',
                    placeholder: 'Folder name',
                    attr: {
                        class: 'input-xlarge'
                    }
                }) }}

                {{ form_rest(folderRenameForm) }}

            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-danger">Save</button>
            </div>
        </form>
    </div>


{% endblock %}